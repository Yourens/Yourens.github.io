

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>The brief design and outline - Youren Shen</title>







<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Youren Shen">
<meta property="og:title" content="The brief design and outline">


  <link rel="canonical" href="http://yourenis.me/the-brief-design-and-outline/">
  <meta property="og:url" content="http://yourenis.me/the-brief-design-and-outline/">



  <meta property="og:description" content="As far as I discussed with Philipp for now, We have found two parts to do for this project.Here is the architecture of our design: ">



  <meta name="twitter:site" content="@shenyouren">
  <meta name="twitter:title" content="The brief design and outline">
  <meta name="twitter:description" content="As far as I discussed with Philipp for now, We have found two parts to do for this project.Here is the architecture of our design: ">
  <meta name="twitter:url" content="http://yourenis.me/the-brief-design-and-outline/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2014-04-07T00:00:00+08:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "The site of Youren Shen",
      "url" : "http://yourenis.me",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://yourenis.me/feed.xml" type="application/atom+xml" rel="alternate" title="Youren Shen Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://yourenis.me/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://yourenis.me/">Youren Shen</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://yourenis.me/blog">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://yourenis.me/resume">Resume</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://yourenis.me/gallery">Gallery</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://yourenis.me/images/bio-photo.jpg" class="author__avatar" alt="Youren Shen">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Youren Shen</h3>
    <p class="author__bio">Normal student from China, Main field on Computer System. We are born to suffering, still struggle in the world.</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Beijing China</li>
      
      
      
        <li><a href="mailto:shenyouren@gmail.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      
      
      
      
        <li><a href="https://www.facebook.com/Yourenisme"><i class="fa fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
      
      
      
      
      
        <li><a href="https://instagram.com/youren.shen"><i class="fa fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
      
      
      
      
        <li><a href="https://github.com/Yourens"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
        <li><a href="https://www.weibo.com/2516720233"><i class="fa fa-fw fa-weibo" aria-hidden="true"></i> Weibo</a></li>
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="The brief design and outline">
    <meta itemprop="description" content="As far as I discussed with Philipp for now, We have found two parts to do for this project.Here is the architecture of our design: ">
    <meta itemprop="datePublished" content="April 07, 2014">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">The brief design and outline
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  4 minute read
	
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>As far as I discussed with Philipp for now, We have found two parts to do for this project.
Here is the architecture of our design: <br />
<img src="http://yourenis.me/images/The\ architecture\ of\ paravirtualization.png" alt="The architecture of paravirtualization" /></p>

<p>Here is Philipp’s illustration:<br />
<img src="http://yourenis.me/images/Philipp\'s\ design.jpg" alt="Philipp's illustration" /></p>

<p>As we can see from the picture, the RTEMS invoke the hypercall by Paravirtualization Layer to communicate with hypervisor, and also the hypervisor will notify the RTEMS through the event channel(we using the concept in XEN temporarily, however, I think we will using the mechanism supplied by POK finally.)<br />
Also the RTEMS will be benefit from this clear and separate design in the future, since it’s easy to reuse the paravirtualization layer to transplant the RTESM on other hypervisor.</p>

<p>####Why hypercall? 
As a native operating system, the RTEMS and all user software executes at privilege level 0 on x86.[1]
Now, as a guest OS, the RTEMS running in privilege level 3(as default) which is not allowed to do everything. So we have to have some mechanism to resolve this problem.</p>

<p>As we can see, this is not a new problem. In the traditional OS, when the application in privilege level 3 wants to do some thing by hardware, like printing something in screen, or get the keyboard inputting, it will invoke the syscall, tell the OS what’s to do, and the OS check the security of the operation, then do it for applications.</p>

<p>Being familiar with syscall, we now also want to do some privilege operation in a high privilege level, typically in level 3. So we could design some thing like syscall named as hypercall as the solution of this problem.</p>

<p>####How to handle the interrupts?</p>

<p>The correct way to handle a interrupt in most native operating system is installing a interrupt handler and when the interrupt occurs, jump to the entry of the interrupt handler. <br />
However, the paravirtualization hypervisor did not doing in this way. The interrupts has been divied into two types, one is the local interrupt, which is important and should be handle by POK, such as clock interrupt and other CPU exception., the other is guest interrupt. We using the hypercall to bind a event port when the guest OS set up. When the guest interrupt happens, we intercepts them rather than passing them directly through to RTEMS.This design allows the POK(also other hypervisor) remain the control of the hardware, scheduling servicing. <br />
However, like we said before, the RTEMS should be allowed to regiser interrupt handlers with POK by paravirtualization layer. And Interrupt occurs when the corresponding RTEMS is waitting to execute will be store in a package, then deliver to RTEMS when it is activated. <br />
When the RTEMS is activated, it should notice the interrupt delivered by event channel, and handle it with there own interrupt handler.</p>

<p>####How Xen handle a physical interrupt.
See it in my next weekend post.</p>

<p>####Clock system in paravirtualization.
Need to be discuss.</p>

<p>####Summary
* what should we implement paravirtualization layer?(in paravirtualization layer)
As far as concerned now, the to-dos in paravirtualization layer includes:
   1. Implement some kind of fake register, and corresponding hypercall with the sensitive instructions.[3]
   2. Implement the register interrupt operation in paravirtualization layer.
   3. Implement a callback function in RTEMS, which will be invoke when a interrupt is delivered. (Analogy with signal in UNIX). In this function, we will jump to the entry of the ture interrupt handler.
* what should we implement to dispatch the interrupts?(in POK kernel)
   1. adapt the meta_handler to workable with the register operation. which includes to add some flags to make the interrupt attribution and the corresponding partition.
   2. using the event channel to delivery interrupts.</p>

<p>####Brief Outline from now.</p>

<p>April 07 – April 14
Reading the  code of the event channel in XEN and the workflow about interrupt delivery.
Write a post about it in weekend.</p>

<p>April 14 – April 22
Reading the code of the communication mechanism of POK and design the detail of interrupt delivery by this communication mechanism. <br />
I will write a post about it in weekend.</p>

<p>April 22 – May 19,2014(Design Period)
Giving more details about functions should be implement by the hypercall in paravirtualization layer.</p>

<p>May 20 – June 27,2014(code period)
In this period, I will accomplish the first and second step in paravirtualization layer and first step in POK kernel.</p>

<p>I will post a blog about what I have do and submit the patch at the end of this period.</p>

<p>June 28 - July 11 2014 (code and test period)
During this period, I will finished all the cod jobs remain, and test some sample like divide zero error exception. Then trying to running more samples of RTEMS on POK.</p>

<p>July  12 - August 25 2014 (name)
Finish all missing documentation.
Write the wiki page.
Write a user manual to introduce how to use the API proived by paravirtualization layer and how to transplant the virtualization layer on another kind of operating system.</p>

<p>If you got any problem or I have any misunderstanding, please contact me by email <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#104;&#101;&#110;&#121;&#111;&#117;&#114;&#101;&#110;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">&#115;&#104;&#101;&#110;&#121;&#111;&#117;&#114;&#101;&#110;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;</a></p>

<p>####Reference:
[1]. <a href="https://rtems.org/onlinedocs/doc-current/share/rtems/html/cpu_supplement/Intel_002fAMD-x86-Specific-Information-Vectoring-of-Interrupt-Handler.html">https://rtems.org/onlinedocs/doc-current/share/rtems/html/cpu_supplement/Intel_002fAMD-x86-Specific-Information-Vectoring-of-Interrupt-Handler.html</a>. <br />
[2]. Chisnall, David. The definitive guide to the xen hypervisor. Pearson Education, 2007. <br />
[3]. <a href="https://docs.google.com/document/d/10ehcM1f2eKNwcNgv5stphGtsVAnYc_K7KLhxmjvE1k8/edit">https://docs.google.com/document/d/10ehcM1f2eKNwcNgv5stphGtsVAnYc_K7KLhxmjvE1k8/edit</a>.</p>

        
      </section>

      <footer class="page__meta">
        
        




        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-04-07T00:00:00+08:00">April 07, 2014</time></p>
        
      </footer>

      

<section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=http://yourenis.me/the-brief-design-and-outline/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://yourenis.me/the-brief-design-and-outline/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://yourenis.me/the-brief-design-and-outline/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://yourenis.me/the-brief-design-and-outline/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://yourenis.me/the-syscall-system-in-pok/" class="pagination--pager" title="The syscall system in POK and interrupt handler in POK
">Previous</a>
    
    
      <a href="http://yourenis.me/an-overview-about-event-channel-in-xen/" class="pagination--pager" title="An overview about Event Channel in XEN
">Next</a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
      <div class="grid__wrapper">
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://yourenis.me/dynamic-libary-debug-record/" rel="permalink">Dynamic Library Debug Record
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  3 minute read
	
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Recently, I have encountered a bug due to an upgrade of the OpenSSL library on Ubuntu 16.04. 
The bug is quite tricky because it’s related to how Linux load ...</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://yourenis.me/rtnetlink-tutorial-in-chinese/" rel="permalink">RTnetlink Tutorial in Chinese
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  1 minute read
	
</p>
    
    <p class="archive__item-excerpt" itemprop="description">rtnetlink是基于netlink机制的一个内核和协议栈相关操作的机制。其允许用户程序对内核的路由表进行读写。是Linux 2.2之后的一个新的功能。这个功能非常重要，在很多基础的工具中的使用也非常广泛。但是很少资料直接对rtnetlink的具体使用进行讲解，中文的资料只有一些对Manual的翻译和补充，Li...</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://yourenis.me/my-workstation/" rel="permalink">My Workstation——论如何正确地加持生产力～
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  less than 1 minute read
	
</p>
    
    <p class="archive__item-excerpt" itemprop="description">从开学到现在，经过一个月的慢慢累积，将工作环境好好提升了一番。


</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://yourenis.me/the-current-workflow-of-interrupt-handling/" rel="permalink">The current workflow of interrupt handling
</a>
      
    </h2>
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  4 minute read
	
</p>
    
    <p class="archive__item-excerpt" itemprop="description">##The workflow of current interrupt handling

###The structure 
As usual, let’s start with key structure:

struct vcpu
{ 
......
    /*
    * This bit will b...</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
    
      <li><a href="https://twitter.com/shenyouren"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
      <li><a href="https://facebook.com/Yourenisme"><i class="fa fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
    
    
      <li><a href="http://github.com/Yourens"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://yourenis.me/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 The site of Youren Shen. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://yourenis.me/assets/js/main.min.js"></script>





  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'Yourensgithubio';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>

